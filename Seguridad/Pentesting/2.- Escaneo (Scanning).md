## Herramientas
```zsh
arp -all
netdiscover 
netstat
nmap
```
- **ARP** se utiliza para supervisar y modificar la tabla de asignaciones de direcciones IP y direcciones MAC** (Media Access Control). ARP utiliza un cache que consiste en una tabla que almacena las asignaciones entre nivel de enlace de datos y las direcciones IP del nivel de red.
- **netdiscover** es una **herramienta activa/pasiva para el reconocimiento de direcciones**, desarrollada principalmente para redes inalámbricas sin servidor dhcp, cuando se está realizando wardriving. Y también puede ser utilizada en redes con hub o switch.
- **netstat** (estadísticas de red) es una herramienta de línea de comandos que muestra las conexiones de red (tanto entrantes como salientes), las tablas de enrutamiento y una serie de estadísticas de las interfaces de red.
- **nmap** es la abreviatura de Network Mapper. Es una herramienta de línea de comandos de Linux de código abierto que se utiliza para escanear direcciones IP y puertos en una red y para detectar aplicaciones instaladas.
## Nmap TCP SYN scan
```zsh
nmap -sS ip
```
El comando `nmap -sS`, conocido como escaneo TCP SYN (o "half-open"), es uno de los métodos más comunes y eficientes que Nmap emplea para detectar puertos abiertos en una máquina remota. Aquí tienes un resumen del funcionamiento y características del escaneo TCP SYN:

### Funcionamiento del escaneo TCP SYN (`nmap -sS`):

1. **Envío de Paquetes SYN**:
    
    - Nmap envía un paquete TCP con la bandera SYN (synchronize) a cada puerto de destino.
    - Este paquete es el primer paso en el establecimiento de una conexión TCP (handshake de tres vías).
2. **Respuesta del Destino**:
    
    - **SYN/ACK**: Si el puerto está abierto, el destino responde con un paquete SYN/ACK.
    - **RST**: Si el puerto está cerrado, el destino responde con un paquete RST (reset).
    - **No Respuesta**: Si no se recibe respuesta, puede indicar que el puerto está filtrado (por un firewall, por ejemplo).
3. **No Completar la Conexión**:
    
    - Si se recibe un SYN/ACK, Nmap no completa la conexión. En lugar de enviar un paquete ACK, envía un paquete RST para cerrar la conexión de manera "incompleta" o "half-open". Esto permite identificar puertos abiertos sin establecer una conexión completa, lo cual es más discreto y menos detectable por sistemas de seguridad.

### Características y Ventajas:

- **Rapidez y Eficiencia**: El escaneo SYN es más rápido que el escaneo completo (conexión completa) ya que no establece conexiones completas.
- **Discreción**: Debido a que no completa la conexión TCP, es menos probable que sea detectado por algunos sistemas de detección de intrusiones (IDS).
- **Compatibilidad**: Funciona en la mayoría de los sistemas operativos y con la mayoría de las implementaciones TCP.

## namp -sT
El comando `nmap -sT` realiza un escaneo TCP Connect, que es una técnica utilizada por Nmap para identificar puertos abiertos en un objetivo. Aquí tienes un resumen del funcionamiento y características del escaneo TCP Connect:

### Funcionamiento del escaneo TCP Connect (`nmap -sT`):

1. **Inicio de Conexión Completa**:
    
    - Nmap intenta establecer una conexión TCP completa con cada puerto de destino. Esto implica el proceso estándar de handshake de tres vías TCP.
2. **Handshake de Tres Vías**:
    
    - **SYN**: Nmap envía un paquete SYN (synchronize) al puerto de destino.
    - **SYN/ACK**: Si el puerto está abierto, el destino responde con un paquete SYN/ACK.
    - **ACK**: Nmap responde con un paquete ACK para completar la conexión.
3. **Determinación del Estado del Puerto**:
    
    - **Conexión Exitosa**: Si el handshake se completa, el puerto está abierto.
    - **RST**: Si el puerto está cerrado, el destino responde con un paquete RST (reset).
4. **Cierre de Conexión**:
    
    - Nmap cierra la conexión inmediatamente después de completarla, enviando un paquete RST.

### Características y Ventajas:

- **Fiabilidad**: Este método es muy confiable y funciona con cualquier usuario, ya que utiliza el sistema operativo subyacente para establecer conexiones.
- **Sin Privilegios de Root**: A diferencia del escaneo SYN (`-sS`), el escaneo TCP Connect no requiere privilegios de root, lo que lo hace accesible para cualquier usuario.
- **Detección Fácil**: Debido a que completa las conexiones, es más fácil de detectar por sistemas de detección de intrusiones (IDS) y firewalls.

#### Averiguar el SO de la maquina atacante
```zsh
nmap -O ip
```
- --version-intensity [0-9]
- -A: Incluye todos los escaneos con alta intensidad
## Averiguar las versiones de los servicios
El comando `nmap -sV` en Nmap se utiliza para la detección de versiones de servicios. Este tipo de escaneo no solo identifica los puertos abiertos en un host, sino que también intenta determinar qué servicios están corriendo en esos puertos y, si es posible, la versión exacta de esos servicios.
### Funcionamiento del escaneo de versiones (`nmap -sV`):

1. **Detección de Puertos Abiertos**:
    
    - Primero, Nmap identifica los puertos abiertos en el host de destino, lo cual puede hacerse mediante un escaneo previo (como `-sS` o `-sT`).
2. **Sondeos de Detección de Versiones**:
    
    - Una vez identificados los puertos abiertos, Nmap envía una serie de sondeos específicos a esos puertos. Estos sondeos incluyen paquetes diseñados para provocar respuestas características de ciertos servicios.
3. **Análisis de Respuestas**:
    
    - Nmap analiza las respuestas recibidas para identificar patrones que correspondan a bases de datos de firmas conocidas. Esto incluye información sobre el servicio y su versión.
    - Nmap utiliza una extensa base de datos interna de firmas de servicios (`nmap-service-probes`) para comparar y determinar el servicio y la versión.
4. **Presentación de Resultados**:
    
    - Los resultados del escaneo muestran los puertos abiertos junto con los servicios y versiones detectadas.

### Características y Ventajas:

- **Precisión**: Al usar sondeos específicos y comparar respuestas con una base de datos de firmas, Nmap puede identificar con precisión el software y la versión que se está ejecutando.
- **Flexibilidad**: Funciona con una amplia gama de servicios y protocolos.
- **Información Detallada**: Proporciona información detallada que es crucial para auditorías de seguridad y análisis de vulnerabilidades.
## Evitar ser detectado por firewalls o IDS
El comando `nmap -f` en Nmap se utiliza para realizar un escaneo con fragmentación de paquetes. Este modo de escaneo está diseñado para evitar ser detectado por algunos sistemas de detección de intrusiones (IDS) y firewalls que podrían bloquear escaneos basados en patrones reconocidos. La fragmentación de paquetes envía datos en fragmentos más pequeños, lo que puede dificultar su identificación como un escaneo por parte de los dispositivos de seguridad de la red.

### Funcionamiento del Escaneo con Fragmentación de Paquetes (`nmap -f`):

1. **Fragmentación de Paquetes**:
    
    - Nmap divide los paquetes en fragmentos más pequeños (normalmente de 8 bytes cada uno) antes de enviarlos al objetivo.
    - Los fragmentos se reensamblan en el destino para formar el paquete completo.
2. **Evasión de IDS/Firewalls**:
    
    - Al dividir el paquete, algunos IDS y firewalls pueden no reconocer los fragmentos individuales como parte de un escaneo, permitiendo que los paquetes lleguen al destino sin ser bloqueados.
3. **Compatibilidad y Riesgos**:
    
    - No todos los sistemas y dispositivos de red manejan correctamente la fragmentación de paquetes, lo que puede resultar en paquetes descartados o respuestas incorrectas.
    - No garantiza la evasión de todos los sistemas de seguridad, ya que algunos IDS y firewalls avanzados pueden detectar y manejar la fragmentación de paquetes.
### Decoys o Senuelos (nmap -D )
El comando nmap -D se utiliza para realizar un escaneo con señuelos (decoys) en Nmap. Esta técnica está diseñada para ocultar la verdadera dirección IP del escáner al generar tráfico desde varias direcciones IP falsas, confundiendo así a los sistemas de detección de intrusiones (IDS) y otros mecanismos de monitoreo de red sobre la verdadera fuente del escaneo.
Funcionamiento del Escaneo con Señuelos (nmap -D):

1. **Generación de Tráfico Falso**:
	Nmap envía paquetes desde múltiples direcciones IP señuelo (decoys) junto con el tráfico real desde la dirección IP del escáner.

2. **Confusión de IDS y Monitores**:
	Los IDS y otros sistemas de monitoreo de red registrarán múltiples direcciones IP como posibles fuentes del escaneo, dificultando la identificación del escáner real.

3. **Configuración de Señuelos**:
	Puedes especificar una lista de direcciones IP señuelo, incluyendo tu propia IP en cualquier punto de la lista. Nmap mezclará los paquetes provenientes de estas direcciones IP.
### Evasion de seguridad con nmap
```zsh
sudo nmap -S 8.8.8.8 -Pn -e eth0 -g 7777
sudo nmap -sF ip
```
El comando sudo nmap -S 8.8.8.8 -Pn -e eth0 -g 7777 combina varias opciones avanzadas de Nmap para realizar un escaneo con suplantación de IP de origen, sin realizar ping previo, especificando una interfaz de red y usando un puerto de origen específico. A continuación se explica cada una de las opciones:
#### Desglose del Comando
**sudo**:
	Ejecuta Nmap con privilegios de superusuario. Algunas opciones avanzadas de Nmap requieren permisos de root para funcionar correctamente.

**nmap**:
	Es el comando para ejecutar Nmap.

**-S** 8.8.8.8:
	Suplanta la dirección IP de origen. Esto hace que el tráfico parezca provenir de la dirección IP 8.8.8.8 (que es una dirección de Google Public DNS).
	Nota: La dirección IP especificada debe ser una dirección válida y suplantar direcciones IP puede ser ilegal o no ético si no tienes permiso para hacerlo.

**-Pn**:
	Desactiva la detección de host. Nmap no realizará un ping previo para comprobar si el host está activo; simplemente asume que todos los hosts especificados están activos.
	Esto es útil para evitar firewalls que bloquean los paquetes de ping.

**-e eth0**:
	Especifica la interfaz de red que Nmap debe usar para el escaneo. En este caso, eth0 es la interfaz de red.
	La interfaz debe existir y estar configurada correctamente en el sistema.

**-g 7777**:
	Establece el puerto de origen de los paquetes enviados por Nmap. Aquí, 7777 es el puerto que se usará como el puerto de origen.
	Esta técnica puede ser utilizada para evadir algunos tipos de reglas de firewall basadas en el puerto de origen.
El comando `sudo nmap -sF <ip>` se utiliza para realizar un escaneo FIN (FIN scan) en Nmap. Este tipo de escaneo es una técnica avanzada que envía paquetes TCP con el bit FIN activado, en lugar de usar el típico paquete SYN utilizado en un escaneo de SYN. A continuación, te explico cómo funciona y cuáles son sus características y usos:
### Funcionamiento del Escaneo FIN (`-sF`):

1. **Envio de Paquetes FIN**:
    
    - Nmap envía un paquete TCP con el bit FIN activado a cada puerto del host de destino. Normalmente, el bit FIN se utiliza para terminar una conexión TCP.
2. **Respuesta del Destino**:
    
    - **Puerto Cerrado**: Si el puerto está cerrado, el host de destino responderá con un paquete RST (Reset).
    - **Puerto Abierto/Filtrado**: Si el puerto está abierto o filtrado, no habrá respuesta del host de destino. Este comportamiento es una característica del estándar TCP/IP.
3. **Detección del Estado del Puerto**:
    
    - Nmap interpreta la falta de respuesta como indicativo de un puerto abierto o filtrado.
    - La recepción de un paquete RST indica que el puerto está cerrado.

### Características y Ventajas del Escaneo FIN:

- **Evasión de IDS/Firewalls**: Este tipo de escaneo puede ser útil para evadir algunos sistemas de detección de intrusiones (IDS) y firewalls que pueden estar configurados para detectar y bloquear escaneos SYN o de conexión completa.
- **Menos Ruido**: Produce menos ruido que un escaneo SYN o de conexión completa porque envía menos paquetes.
- **Requiere Permisos de Root**: Debido a la necesidad de construir paquetes TCP personalizados, este escaneo requiere permisos de superusuario (root).
